<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- BOOTSTRAP STYLES-->
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link th:href="@{/css/font-awesome.css}" rel="stylesheet" />
    <!--CUSTOM BASIC STYLES-->
    <link th:href="@{/css/basic.css}" rel="stylesheet" />
    <!--CUSTOM MAIN STYLES-->
    <link th:href="@{/css/custom.css}" rel="stylesheet" />
    <!--TABLE STYLES-->
    <link th:href="@{/css/table-style.css}" rel="stylesheet" />
</head>
<body>

    <div id="wrapper">
        <!-- /. NAV TOP  -->
        <div th:replace="~{topbar/topbar::topbar}"></div>
        <!-- /. NAV SIDE  -->
        <div th:replace="~{sidebar/side-bar::sidebar}"></div>

        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="page-head-line">Profile</h1>
                        <h1 class="page-subhead-line">在这里，你可以查看并修改个人的账户信息。 </h1>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div id="userInfoTable"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-5">
                            <div id="roleElementTable"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div id="roleElementTable_ext"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div id="roleSkillTable"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            panel-heading
                        </div>
                        <div class="panel-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /. ROW  -->
            </div>
            <!-- /. PAGE INNER  -->
        </div>
    <!-- /. PAGE WRAPPER  -->
    </div>


<script th:src="@{/js/jquery-1.10.2.js}"></script>
<!-- BOOTSTRAP SCRIPTS -->
<script th:src="@{/js/bootstrap.js}"></script>
<!-- METISMENU SCRIPTS -->
<script th:src="@{/js/jquery.metisMenu.js}"></script>
<!-- CUSTOM SCRIPTS -->
<script th:src="@{/js/custom.js}"></script>
</body>
</body>
<script type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $("#Modify_UserInfo_a").addClass("active-menu");
        let UserId = [[${UserId}]];
        $.ajax({
            type: "POST",
            url: "/userInfo",
            datatype: "json",
            data: "userId=" + UserId,
            success: function (data) {
                //console.log(data);
                showInfoTable(data);
            },
            error: function (data) {
                console.log(data)
                console.log("Failed");
                alert("服务器似乎出现了一点问题，稍后再试试吧");
            }
        })
    })

    function showInfoTable(data) {
        //console.log(data);
        let userTableHtml = "<div class='panel panel-default'>"
            + " <div class = 'panel-heading'>属性</div>"
            + "<div class='panel-body'>"
            + "<div class='table-responsive'>"
            + "<table class='table table-striped table-bordered table-hover'>"
            + "<tbody>"
            +"<tr>"
            +"<th id ='userAssignment_head' class = 'cell-head userBaseInfo-cell-head'>个性签名</th>"
            +"<th id ='userAssignment_val' class = 'cell-val  userBaseInfo-cell-val'>"+data.userAssignment+"</th>"
            +"</tr>"
            +"<tr>"
            +"<th id ='userEmail_head' class = 'cell-head userBaseInfo-cell-head'>邮箱地址</th>"
            +"<th id ='userEmail_val' class = 'cell-val  userBaseInfo-cell-val'>"+data.userEmail+"</th>"
            +"</tr>"
            +"<tr>"
            +"<th id ='userGender_head' class = 'cell-head userBaseInfo-cell-head'>性别</th>"
            +"<th id ='userGender_val' class = 'cell-val  userBaseInfo-cell-val gender'>"+data.userGender+"</th>"
            +"</tr>"
            +"<tr>"
            +"<th id ='userName_head' class = 'cell-head userBaseInfo-cell-head'>用户名</th>"
            +"<th id ='userName_val' class = 'cell-val  userBaseInfo-cell-val'>"+data.userName+"</th>"
            +"</tr>"
            +"<tr>"
            +"<th id ='userPassword_head' class = 'cell-head userBaseInfo-cell-head'>用户密码</th>"
            +"<th id ='userPassword_val' class = 'cell-val '><text class = 'cell-edit-button' id = 'PasswordEditButton'> 修改密码 </text></th>"
            +"</tr>"
            +" </tbody> "
            + "</table>"
            + "</div>"
            + "<text class = 'edit-button' id = 'userInfoEditButton'> 编辑 </text>"
            + "</div> "
            + "</div>"
        $("#userInfoTable").html(userTableHtml);
        let genderVal = document.getElementsByClassName("gender")[0];
        //console.log(genderVal);
        if(genderVal.innerText==="0")
            genderVal.innerText="女";
        else if(genderVal.innerText==="1")
            genderVal.innerText="男";
        else if($(".gender").innerText==="2")
            genderVal.innerText="其他";


        $("#userInfoEditButton").click(function () {
            let button = document.getElementById("userInfoEditButton");
            if(button.innerText === "编辑"){
                button.innerText = "确认修改"
                let cells = document.getElementsByClassName("userBaseInfo-cell-val");
                console.log(cells);
                for(let i = 0; i < cells.length; i++){
                    if(cells[i].classList.contains("gender")){
                        cells[i].innerHTML = "<select>" +
                            "<option "+((genderVal.innerText==="男")?"selected='selected'":"") +">男</option>"+
                            "<option "+((genderVal.innerText==="女")?"selected='selected'":"") +">女</option>"+
                            "<option "+((genderVal.innerText==="其他")?"selected='selected'":"") +">其他</option>"+
                            "</select>";
                    }
                    else {
                        cells[i].innerHTML = "<input style=\"\" value=\"" + cells[i].innerText + "\"/>";
                    }
                }
            }
            else if(button.innerText === "确认修改"){
                button.innerText = "编辑"
            }
        })



    }

</script>
</html>